





















<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Mafin</title>

<!-- 플러그 css -->
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/axisj/arongi/AXJ.min.css">
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/covision.control.css">
<!-- 서버용 -->		
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/jquery.mCustomScrollbar.css" />
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/common.css" />
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/covision/Controls.css" />
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/theme/blue.css" />	
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/login.css" />


	<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/customizing/Upxide/css/login.css" />


<!-- 기존 로그인 -->
<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/covision/user_common_controls.css" />
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/jquery.min.js"></script>
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/Controls/Common.js"></script>
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/Controls/CommonControls.js"></script>
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/Controls/Utils.js"></script>
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/Controls/covision.common.js"></script>

<link rel="stylesheet" type="text/css" href="//gw.mafinglobal.com/HtmlSite/smarts4j_n/covicore/resources/css/jquery-ui-1.12.1.css" />
<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/jquery-ui-1.12.1.js"></script>


	<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/security/AesUtil.js"></script>
	<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/security/aes.js"></script>
	<script type="text/javascript" src="//gw.mafinglobal.com/covicore/resources/script/security/pbkdf2.js"></script>


<!-- grid -->
<script type="text/javascript" language="javascript">
	/* 비밀번호 확인 → 계정잠금 확인 → two factor → 동시접속 확인 */
	var loginState = "success";  //로그인 실패 시 fail 로 넘어옴.
	var samlLogin = "N";
	var ssoType = "1";
	var samlRequest = "";
	var cryptoType = "A";
	var useFIDO = "N"; //파이도 사용여부 
	
	$(document).ready(function () {		
		if(document.location.href.indexOf("login.do") < 0){
			location.href='/covicore/login.do';
		}
		
		
		if(useFIDO == "Y"){
			changeLoginType($("#tabFIDO"));
			$("#LoginTypeTabDiv").show();
		}
		
		if(ssoType == "0" || samlLogin == "N"){
			$("#ssoCheckbox").hide();
		}
		if(samlRequest != null && samlRequest != "" ){
			$("#ssoCheckbox").hide();
		}
		
		if(loginState == "fail"){
			//alert("로그인 실패");
			Common.Warning("아이디 또는 비밀번호가 맞지 않습니다.","ERROR",function(){
				location.href='/covicore/login.do';
			});
		} 
		$("#id").val("");
		$("#password").val("");
		$("#fidoid").val("");
		
		$("#id").hide();
		$("#password").hide();
		$("#fidoid").hide();
		
		$("#idtemp").focus(function () {
			$("#idtemp").hide();
			$("#id").show().focus();			
		});
				
		$("#passwordtemp").focus(function () {
			$("#passwordtemp").hide();
			$("#password").show();
			
			$("#password").focus();
		});
		
		$("#fidoidtemp").focus(function () {
			$("#fidoidtemp").hide();
			$("#fidoid").show().focus();			
		});
		
		$("#id").blur(function () {
			if($("#id").val() == ""){
				$("#id").hide();
				$("#idtemp").show();
			}
		});
		
		$("#password").blur(function () {
			if($("#password").val() == ""){
				$("#password").hide();
				$("#passwordtemp").show();
			}
		});
		
		$("#fidoid").blur(function () {
			if($("#fidoid").val() == ""){
				$("#fidoid").hide();
				$("#fidoidtemp").show();
			}
		});
		
		$("#checkID").click(function(){
			if($("#checkID").prop("checked")){
				coviCmn.setCookie("loginIdCheck", "Y", 1);			
			}else{			
				coviCmn.setCookie("loginIdCheck", "N", 1);
			}
		});
		
		//쿠키
		var cookieIDCheck = coviCmn.getCookie("loginIdCheck");		
		if(cookieIDCheck!="" && cookieIDCheck != "undefined" && cookieIDCheck == 'Y'){
			$("#checkID").click();
		}
		
		//쿠키
		var cookieID = coviCmn.getCookie("loginId");		
		if(cookieID!="" && cookieID != "undefined"){
			$("#idtemp").val(cookieID);								
			$("#id").val(cookieID);
			
			$("#fidoidtemp").val(cookieID);
			$("#fidoid").val(cookieID);
		}

		var cookieLang = coviCmn.getCookie("langCode");
		if(cookieLang!="" && cookieLang != "undefined"){
			$("#langList").val(cookieLang);
			$(".langSelect").val(cookieLang);
		}
	});
	
	function loginChk(){
		setCookieData();
		
		if(bool_Check()){
			var encPassword = "";
			if(cryptoType == "R"){
				var rsaPublicKeyModulus = $("#rsaPublicKeyModulus").val();
				var rsaPublicKeyExponent = $("#rsaPublicKeyExponent").val();
				encPassword = fnRsaEnc($("#password").val(), rsaPublicKeyModulus, rsaPublicKeyExponent);
			}else if(cryptoType == "A"){
				
				 var aesUtil = new AesUtil("128", "1000");
				 
				 encPassword = aesUtil.encrypt("18b00b2fc5f0e0ee40447bba4dabc952", "4378110db6392f93e95d5159dabdee9b", "1234", $("#password").val());
				
			}else{
				encPassword = $("#password").val();
			}
			
			$.ajax({
				method: "POST",
			    data: {id : $("#id").val(), pw : encPassword, language : $(".langSelect").val(), activeTime:localStorage.getItem($("#id").val() + "_sessionLastActiveTime")},
				url: "loginbasechk.do",
				success:function (data) {
					 if(data.result =="ok"){
						$("#frm").attr("method","POST")
						$("#frm").attr("action", "loginchk.do");
						$("#frm").submit();		
					 }else if(data.result == "lock"){
						 Common.Warning("계정이 잠금되었습니다. 비밀번호 재설정 바랍니다.");
						 return ;
					 }else if(data.result == "inaccessIP"){ //사용자 IP 접근권한 없음
						 Common.Warning("해당 계정 로그인 권한이 없는 IP 입니다.");
						 return ;
					 }else if(data.result == "factor"){
						 if(useFIDO =="Y"){ //파이도 사용여부
							 Common.open("", "authwarning", "Warning","/covicore/control/authWarningPopup.do", "300px", "210px", "iframe", true, null, null, true);	
						 }else{
							Common.Warning("외부망으로 접속하였습니다. OTP인증이 필요합니다.","Warning",function(){
								 Common.open("", "OTP", "TWO FACTOR 인증","/covicore/control/twoFector.do?id="+$("#id").val(), "520px", "310px", "iframe", true, null, null, true);	
							});
						 }
						 return ;
					 }else if(data.result == "duplication"){
						Common.Confirm("현재 다른 PC에서 접속 중입니다.<br>다른 사용자의 접속을 끊으시겠습니까?", "Confirm", function(result){
							if(result){
								duplicationLogin();
							}
						});
					 } else{
						Common.Warning("아이디 또는 비밀번호가 맞지 않습니다.");
						return ;
					 }
				
				}
			
			});  
		
		}
	}
	function bool_Check() {
	    var bReturn = true;
		if (($("#id").val() == "아이디") ||($("#id").val() == "")) {
	    	bReturn = false;
	    	Common.Warning("아이디를 입력하여 주십시오.","ERROR");
	    } else if ($("#password").val() == "") {
	    	bReturn = false;
	    	Common.Warning("비밀번호를 입력하여 주십시오.","ERROR");
	    }
		return bReturn;
	}
	
	function selectBox(pObj){		
		if($('.langList').css('display') == 'none'){
			$('.langList').show();
		}else{
			$('.langList').hide();
		}		
		$(".langSelect").html($("#langList>option:selected").text());
		$(".langSelect").val($("#langList").val());
	}
	
	function setCookieData(type){ //undefined or fido
		if($("#checkID").prop("checked")){
			var loginVal; 
			
			if(type == "fido"){
				loginVal = $("#fidoid").val();
			}else{
				loginVal = $("#id").val();
			}
			
			coviCmn.setCookie("loginId", loginVal, 1);			
		}else{			
			coviCmn.setCookie("loginId", "", 1);
		}
		
		//사용언어 설정 저장
		coviCmn.setCookie("langCode", $('#langList').val(), 1);
	}
	
	//saveid체크
	function checkUseId(pObj){		
		var objClass = $(pObj).attr("class");		
		if(objClass=="checkOn"){
			$(pObj).attr("class","checkOff");					
		}else if(objClass=="checkOff"){
			$(pObj).attr("class","checkOn");				
		}		
	}
	
	function checkFido(){
		if (($("#fidoid").val() == "아이디") || ($("#fidoid").val() == "ID") ||($("#fidoid").val() == "")) {
	    	Common.Warning("아이디를 입력하여 주십시오.","ERROR");
		}else{
			Common.open("", "checkFido", "사용자 본인인증 요청", "/covicore/control/checkFido.do?logonID="+$("#fidoid").val()+"&authType=Login", "400px", "510px", "iframe", true, null, null, true); //사용자 본인인증 요청
		}
	}
	
	function changeLoginType(obj){
		$("#LoginTypeTabDiv li").attr("class", "FDtabMenuOff");
		$(obj).attr("class", "FDtabMenuOn");
		
		if($(obj).attr("value") =="Password"){
			$("#LoginDiv").show();
			$("#FIDOLoginDiv").hide();
		}else if($(obj).attr("value") =="FIDO"){
			$("#LoginDiv").hide();
			$("#FIDOLoginDiv").show();
		}
	}
	
	function checkSSO(pObj){		
		var objClass = $(pObj).attr("class");		
		if(objClass=="checkOn"){
			$(pObj).attr("class","checkOff");
		}else if(objClass=="checkOff"){
			$(pObj).attr("class","checkOn");		
			$("#frm").attr("method","POST")
			$("#frm").attr("action", "samlLogin.do");
			$("#frm").submit();	
		}		
	}
	
	function infoSePolicy(pModal){
		Common.open("", "SecurityPolicy", "정보보안정책", "/covicore/control/callSecurityPolicy.do", "491px", "523px", "iframe", true, null, null, true);
			
	}
	
	function resetPassword(pModal){
		Common.open("", "PasswordReset", "비밀번호 재설정","/covicore/control/callPasswordReset.do", "520px", "480px", "iframe", true, null, null, true);
	}
	
	function fnRsaEnc(value, rsaPublicKeyModulus, rsaPpublicKeyExponent) {
		
	    var rsa = new RSAKey();

	    rsa.setPublic(rsaPublicKeyModulus, rsaPpublicKeyExponent);
	    var encValue = rsa.encrypt(value)
	    
	    return encValue;

	}
	
	function twoFactorLogin(otpNumber){
		
		var encPassword = "";
		
		if(cryptoType == "R"){
			var rsaPublicKeyModulus = $("#rsaPublicKeyModulus").val();
			var rsaPublicKeyExponent = $("#rsaPublicKeyExponent").val();
			encPassword = fnRsaEnc($("#password").val(), rsaPublicKeyModulus, rsaPublicKeyExponent);
		}else if(cryptoType == "A"){
			
			 var aesUtil = new AesUtil("128", "1000");
			 
			 encPassword = aesUtil.encrypt("18b00b2fc5f0e0ee40447bba4dabc952", "4378110db6392f93e95d5159dabdee9b", "1234", $("#password").val());
			
		}else{
			encPassword = $("#password").val();
		}
		
		$.ajax({
			method: "POST",
		    data: {id : $("#id").val(), pw: encPassword , otp : otpNumber, language : $("#langList").val()},
			url: "loginTwoFactorChk.do",
			success:function (data) {
				 if(data.result =="ok"){
					$("#frm").attr("method","POST")
					$("#frm").attr("action", "loginchk.do");
					$("#frm").submit();		
				 }else{
					Common.Warning("인증번호를 다시 확인해주세요.","ERROR");
					return ;
				 }
			
			}
		
		}); 
		
	}
	
	
	function duplicationLogin(){
		var encPassword = "";
		
		if(cryptoType == "R"){
			var rsaPublicKeyModulus = $("#rsaPublicKeyModulus").val();
			var rsaPublicKeyExponent = $("#rsaPublicKeyExponent").val();
			encPassword = fnRsaEnc($("#password").val(), rsaPublicKeyModulus, rsaPublicKeyExponent);
		}else if(cryptoType == "A"){
			
			 var aesUtil = new AesUtil("128", "1000");
			 console.log("%o, %o, %o,","18b00b2fc5f0e0ee40447bba4dabc952", "4378110db6392f93e95d5159dabdee9b", "1234");
			 encPassword = aesUtil.encrypt("18b00b2fc5f0e0ee40447bba4dabc952", "4378110db6392f93e95d5159dabdee9b", "1234", $("#password").val());
			
		}else{
			encPassword = $("#password").val();
		}
		
		$.ajax({
			method: "POST",
		    data: {id : $("#id").val(), pw: encPassword , language : $("#langList").val()},
			url: "/covicore/loginDuplicationChk.do",
			success:function (data) {
				 if(data.result =="ok"){
					$("#frm").attr("method","POST")
					$("#frm").attr("action", "loginchk.do");
					$("#frm").submit();		
				 }
			}
		
		}); 
		
	}
	
	//fido callback 함수 
	function fidoCallBack(){
		setCookieData('fido');
		 var pID = ($("ul.FDtabMenu li.FDtabMenuOn").attr("value")=="FIDO" ? $("#fidoid").val() : $("#id").val());
		 
		$.ajax({
			method: "POST",
		    data: {id : pID, pw : "" , language : $(".langSelect").val(), isFIDO: "Y" },
			url: "loginbasechk.do",
			success:function (data) {
				 if(data.result =="ok"){
					$("#id").val(pID);
					$("#isFIDO").val("Y");
					$("#frm").attr("method","POST")
					$("#frm").attr("action", "loginchk.do");
					$("#frm").submit();		
				 }else if(data.result == "lock"){
					 Common.Warning("계정이 잠금되었습니다. 비밀번호 재설정 바랍니다.","ERROR");
					 return ;
				 }else if(data.result == "inaccessIP"){ //사용자 IP 접근권한 없음
					 Common.Warning("해당 계정 로그인 권한이 없는 IP 입니다.");
					 return ;
				 }/* else if(data.result == "factor"){ //이미 생체인증이 된 상태에서는 two factor를 체크할 필요가 없음
					 if(useFIDO =="Y"){ //파이도 사용여부
						 Common.open("", "authwarning", "Warning","/covicore/control/authWarningPopup.do", "300px", "210px", "iframe", true, null, null, true);	
					 }else{
						Common.Warning("외부망으로 접속하였습니다. OTP인증이 필요합니다.","Warning",function(){
							 Common.open("", "OTP", "TWO FACTOR 인증","/covicore/control/twoFector.do?id="+$("#id").val(), "520px", "310px", "iframe", true, null, null, true);	
						});
					 } 
					 return ;
				 } */else if(data.result == "duplication"){
					Common.Confirm("현재 다른 PC에서 접속 중입니다.<br>다른 사용자의 접속을 끊으시겠습니까?", "Confirm", function(result){
						if(result){
							duplicationLogin();
						}
					});
				 }/*  else{
					Common.Warning("아이디 또는 비밀번호가 맞지 않습니다.","ERROR");
					return ;
				 } */
			
			}
		
		});  
	}

	function callBackSelectAuth(authType){
		switch(authType){
			case 'OTP': 	 
				Common.open("", "OTP", "TWO FACTOR 인증","/covicore/control/twoFector.do?id="+$("#id").val(), "520px", "310px", "iframe", true, null, null, true);
				break;
			case 'FIDO': 
				Common.open("", "checkFido", "사용자 본인인증 요청", "/covicore/control/checkFido.do?logonID="+$("#id").val()+"&authType=Login", "400px", "510px", "iframe", true, null, null, true); //사용자 본인인증 요청
				break;
		}
	}
		
	
</script>
</head>
<body>	
	<div id='wrap'>		
	<form method="post" id="frm">	
	<input type="hidden" id="isFIDO" name="isFIDO" value="N"/>
	<input type="hidden" id="RelayState" name="RelayState" value=""/>
	<input type="hidden" id="SamlRequest" name="SamlRequest" value=""/>
	<input type="hidden" id="uid" name="uid" value=""/>
	<input type="hidden" id="acr" name="acr" value=""/>
	<input type="hidden" id="destination" name="destination" value=""/>
	<input type="hidden" id="rsaPublicKeyModulus" value="">
	<input type="hidden" id="rsaPublicKeyExponent" value="">
	
		<section class="loginContent2">
			<h1><a href="#" class="covision">covision</a></h1>
			<div class="title">
				<p class="title01"></p>
			</div>
			<div class="background">
				
					
						<div class="background_img"></div>
				    
				    
				
            </div>
<!-- 			<video class="main_video" id="main-video" preload="metadata" autoplay="" loop=""> -->

<!-- 			</video> -->
			<section class="loginCont">
				<p></p>
				<article>
<!-- 					<article  class="infoSePolicy"><a href="javascript:;" onclick="infoSePolicy();return false;">정보보호 정책</a></article> -->
					<article class="loginBox mt20">
						<article>
							<p>
								<strong>GROUPWARE</strong>
								<br />
								<strong>SYSTEM</strong>
							</p>
						</article>
						<article class="loginInputCont">
							<div class="loginSelectCont">
							 <input type="hidden" name="language" class="langSelect" value="ko"/>
								<select class="selectType05" id="langList" onclick="selectBox(this);">
							          	<option value="ko">Kor</option>
							          	<option value="en">Eng</option>
							          	<option value="ja">Jpn</option>
							          	<option value="zh">Chn</option>
								</select>
							</div>
							<!-- FIDO tab -->
							<div id="LoginTypeTabDiv" class="fidoTab" style="display:none;" >
								<div>
									<ul class="FDtabMenu clearFloat">
										<li onclick="changeLoginType(this)" id="tabFIDO" value="FIDO" class="FDtabMenuOn"><a>생체인증</a></li>
										<li onclick="changeLoginType(this)" id="tabPassword" value="Password" class="FDtabMenuOff"><a>비밀번호</a></li>
									</ul>
								</div>
							</div>
							<!-- FIDO tab -->
							
							<!-- 비밀번호 로그인 입력창 시작 -->
							<div id="LoginDiv" class="PwLoginInputWrap">
								<div class="mt15">
								
								<input type="text" id="idtemp" name="idtemp" class="roundInput" value="ID">
	          					<input type="text" id="id" name="id" class="roundInput" value="" onkeypress="if (event.keyCode==13){ loginChk(); return false;}" onkeyup="this.value=this.value.replace(/[^a-zA-Z-_.0-9]/g,'');">    
								
								</div>
								<div class="mt5">
								
								<input type="text" id="passwordtemp" name="passwordtemp" class="roundInput" value="Password" >
	          					<input type="password" id="password" name="password" class="roundInput" value="" onkeypress="if (event.keyCode==13){ loginChk(); return false;}" >    
								<input type="button" id ="btnFIDO" name="btnFIDO" value="FIDO"  onclick="checkFido(); return false;"style="display: none; background-color: #919aa0;   border: 1px solid #919aa0;   padding: 0px 10px 0px 6px; font-size: 15px;  cursor:pointer;  width: auto;"/>
								</div>
								
								<div class="mt20">
	    							<a href="#" onclick="javascript:loginChk();" class="btnLogin">LOGIN</a>
								</div>
							</div>
							<!-- 비밀번호 로그인 입력창 종료 -->
							
							<!-- FIDO 로그인 입력창 시작-->
							<div id="FIDOLoginDiv" class="FIDOLoginInputWrap" style="display:none;">
								<div class="mt15">
									<input type="text" id="fidoidtemp" name="fidoidtemp" class="roundInput" value="ID">
									<input type="text" id="fidoid" name="fidoid"  class="roundInput"  onkeypress="if (event.keyCode==13){ checkFido(); return false;}" onkeyup="this.value=this.value.replace(/[^a-zA-Z-_.0-9]/g,'');" />
								</div>
								<div class="mt20">
									<a class="btnLogin" onclick="checkFido(); return false;">생체인증 로그인</a>
								</div>
							</div>
							<!-- FIDO 로그인 입력창 종료-->
							
							
							<div class="mt15 loginSetting">
								<div class="chkStyle07">
									<input type="checkbox" id="checkID"><label for="checkID" ><span></span>아이디 저장</label>
								</div>
								<div class = "chkStyle07" id="ssoCheckbox">
									<input type="checkbox" onclick="checkSSO(this);" id="aaaallSV02"><label><span id="checkSSO" onclick="checkSSO(this)" class="checkOff"></span></label>
								</div>
								<div class = "chkStyle07">
									<a href="javascript:;" onclick = "resetPassword();return false;" class="btnPwReOption">비밀번호 재설정</a>
								</div>
							</div>
						</article>
					</article>
				</article>
				<article class="loginInfo">
<!-- 					<p class="tit">Help Desk</p> -->
<!-- 					<p class="telNumber"><span><strong>T.</strong> 02-1541-6512</span><span class="cLine">|</span><span ><strong>M.</strong> 010-1541-4575</span></p> -->
					<p class="txt">임직원용 시스템으로 인가된 사용자만 사용 할 수 있습니다.
					<br />불법으로 사용시에는 법적 제재를 받을 수 있습니다.</p>
					
					<p class="copyright">Copyright ⓒ covision Corp. All Rights Reserved.</p>
				</article>
			</section>
		</section>
	</form>
	</div>
</body>
</html>

